drop table if exists student_attendance;
-- 1. 创建表结构
CREATE TABLE if not exists student_attendance (
                                          id INT PRIMARY KEY AUTO_INCREMENT,
                                          name VARCHAR(50) NOT NULL,
                                          student_id VARCHAR(20) NOT NULL,
                                          class_count INT NOT NULL,
                                          sign_count INT NOT NULL
);

-- 2. 插入数据
INSERT INTO student_attendance (name, student_id, class_count, sign_count) VALUES
                                                                               ('罗舒笑', '20251504336', 28, 28),
                                                                               ('杨凯茹', '20251504444', 28, 28),
                                                                               ('李畅', '20251504323', 28, 28),
                                                                               ('梁铠岚', '20251504346', 28, 27),
                                                                               ('徐铭秀', '20251504314', 28, 28),
                                                                               ('罗雅晴', '20251504341', 28, 28),
                                                                               ('杨泽浩', '20251504387', 28, 27),
                                                                               ('张澜舰', '20251504443', 28, 24),
                                                                               ('易可芸', '20251504361', 28, 28),
                                                                               ('陈怡霏', '20251504308', 28, 28),
                                                                               ('曾颖', '20251504431', 28, 28),
                                                                               ('唐思琪', '20251504369', 28, 26),
                                                                               ('冯梓瑄', '20251504438', 28, 28),
                                                                               ('林钰然', '20251504345', 28, 28),
                                                                               ('赵栩柔', '20241704698', 28, 22),
                                                                               ('林伊婷', '20251504392', 28, 28),
                                                                               ('柳妍惠', '20251504410', 28, 28),
                                                                               ('阮雪莹', '20251504413', 28, 28),
                                                                               ('李婧', '20251504310', 28, 28),
                                                                               ('聂诗轩', '20251504449', 28, 28),
                                                                               ('包睿', '20251504434', 28, 28),
                                                                               ('巫嘉怡', '20251504376', 28, 28),
                                                                               ('杨洋', '20251504313', 28, 28),
                                                                               ('陈心悦', '20251504401', 28, 27),
                                                                               ('蔡晓钰', '20251504366', 28, 28),
                                                                               ('余泓毅', '20251504354', 28, 25),
                                                                               ('陈国铭', '20251504306', 28, 28),
                                                                               ('韦炜', '20251504427', 28, 27),
                                                                               ('罗嘉泓', '20251504386', 28, 27),
                                                                               ('陈凯琳', '20251504424', 28, 28),
                                                                               ('黄熙童', '20251504421', 28, 27),
                                                                               ('黄乐怡', '20251504357', 28, 27),
                                                                               ('黄若熙', '20251504398', 28, 28),
                                                                               ('李春梅', '20251504365', 28, 28),
                                                                               ('庄钰', '20251504312', 28, 28),
                                                                               ('吴林泽', '20251504320', 28, 28),
                                                                               ('王思颖', '20251504383', 28, 28),
                                                                               ('蓝思颖', '20251504321', 28, 27),
                                                                               ('金彦晞', '20251504353', 28, 28),
                                                                               ('李怡萱', '20251504333', 28, 28),
                                                                               ('江莹', '20251504418', 28, 28),
                                                                               ('高一茗', '20251504428', 28, 28),
                                                                               ('陈钰泉', '20251504356', 28, 28),
                                                                               ('范蕊菲', '20251504329', 28, 28),
                                                                               ('程菲', '20251504331', 28, 28),
                                                                               ('黄琪', '20251504405', 28, 28),
                                                                               ('马英杰', '20251504307', 28, 28),
                                                                               ('吴雯晶', '20251504408', 28, 25);
-- 1. 首先在表中添加请假次数列
ALTER TABLE student_attendance
   ADD COLUMN leave_count INT DEFAULT 0 COMMENT '请假次数';

-- 2. 更新韦炜的签到次数（10月28日补上一节课，签到次数+1）
UPDATE student_attendance
SET sign_count = sign_count + 1
WHERE name = '韦炜' AND student_id = '20251504427';
-- 注释：韦炜在10月28日补上一节课，所以签到次数增加1次

-- 3. 更新张澜舰的签到次数和请假次数
-- 张澜舰11月3日补上一节课（签到次数+1）
-- 张澜舰12月1日请假（请假次数+1）
-- 张澜舰12月8日请假（请假次数+1）
UPDATE student_attendance
set sign_count = sign_count + 1, -- 11月3日补课增加1次签到
    leave_count = leave_count + 2 -- 12月1日和12月8日两次请假
WHERE name = '张澜舰' AND student_id = '20251504443';
-- 注释：张澜舰补课1次增加签到，请假2次增加请假次数

-- 4. 更新余泓毅的请假次数
-- 余泓毅提交了12月24日公假条（请假次数+1）
-- 余泓毅12月2日请假（请假次数+1）
UPDATE student_attendance
SET leave_count = leave_count + 2
WHERE name = '余泓毅' AND student_id = '20251504354';
-- 注释：余泓毅有2次请假（公假和事假）

-- 5. 更新黄乐怡的请假次数
-- 黄乐怡12月1日请假（请假次数+1）
UPDATE student_attendance
SET leave_count = leave_count + 1
WHERE name = '黄乐怡' AND student_id = '20251504357';
-- 注释：黄乐怡有1次请假

-- 6. 验证更新结果
SELECT name, student_id, class_count, sign_count, leave_count
FROM student_attendance
WHERE name IN ('韦炜', '张澜舰', '余泓毅', '黄乐怡');

-- 查询姓名、学号、出勤百分率（考虑请假和补签）
SELECT
    name AS '姓名',
    student_id AS '学号',
    -- 计算出勤百分率：考虑签到次数和请假次数，格式化为百分比
    CONCAT(FORMAT(((sign_count + leave_count) * 100.0 / class_count), 2), '%') AS '出勤百分率',
    -- 显示详细信息用于验证
    class_count AS '班级开课数',
    sign_count AS '签到次数',
    leave_count AS '请假次数',
    sign_count + leave_count AS '有效出勤数'
FROM student_attendance
ORDER BY name;
